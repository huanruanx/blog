;jQuery( function() {
    // 关闭页面loading
    setTimeout(function () {
        $('#lyear-preloader').fadeOut(500, function () {
            $('#lyear-preloader').removeClass('loading');
        });
    }, 500);
    
    // 停止
    $("body").on('click', '[data-stopPropagation]', function (e) {
        e.stopPropagation();
    });
    
    // 滚动条
    if($('.lyear-scroll')[0]) {
        $('.lyear-scroll').each(function(){
            new PerfectScrollbar(this, {
	        	swipeEasing: false,
	        	suppressScrollX: true
	        });
        });
    }
    
    // 工具提示
	if($('[data-toggle="tooltip"]')[0]) {
		$('[data-toggle="tooltip"]').tooltip({
			"container" : 'body',
		});
	}
    
    // POP弹出框
    if($('[data-toggle="popover"]')[0]) {
        $('[data-toggle="popover"]').popover();
    }
  
    // 关闭卡片
    $(document).on('click', '.card-btn-close', function() {
        $(this).closest('.card').fadeOut(150, function() {
            if ($(this).parent().children().length == 1) {
                $(this).parent().remove();
            } else {
                $(this).remove();
            }
        });
    });
  
    // 卡片收缩与打开
    $(document).on('click', '.card-btn-slide', function(){
        $(this).toggleClass('rotate-180').closest('.card').find('.card-body').slideToggle();
    });

    // 下拉选择
    if($('.selectpicker')[0]) {
        $('.selectpicker').selectpicker();
    }
});

// 参考国外模板的写法，获取当前的配置，以data-*（*指插件原有的配置名）
getDataOptions = function(el, castList) {
    var options = {};
    
    $.each( $(el).data(), function(key, value){
    
        key = dataToOption(key);
        
        if ( key == 'provide' ) {
            return;
        }
        options[key] = value;
    });
    
    return options;
}

dataToOption = function(name) {
    return name.replace(/-([a-z])/g, function(x){return x[1].toUpperCase();});
}

/**
 * 此处因为部分设备出现兼容问题，已被修改，源官方代码在下文（已被注释）
 */
/*
 * 通用的通知消息方法
 * @param $msg 提示信息
 * @param $type 提示类型:'info', 'success', 'warning', 'danger'
 * @param $delay 毫秒数，例如：1000
 * @param $icon 图标，例如：'fa fa-user' 或 'glyphicon glyphicon-warning-sign'
 * @param $from 'top' 或 'bottom' 消息出现的位置
 * @param $align 'left', 'right', 'center' 消息出现的位置
 */
function showNotify($msg, $type, $delay, $icon, $from, $align) {
    $type  = $type || 'info';
    $delay = $delay || 1000;
    $from  = $from || 'top';
    $align = $align || 'center';
    $enter = $type == 'danger' ? 'animated shake' : 'animated fadeInUp';
    $icon  = $icon || 'fa fa-user'; // 当没有选择图标的时候就选择默认的一个
    jQuery.notify({
        // icon: $icon,
        icon: 'fa fa-user',
        message: $msg
    },
    {
        element: 'body',
        type: $type,
        allow_dismiss: true,
        newest_on_top: true,
        showProgressbar: true,
        placement: {
            from: $from,
            align: $align
        },
        offset: 20,
        spacing: 10,
        z_index: 10800,
        delay: $delay,
        animate: {
            enter: $enter,
            exit: 'animated fadeOutDown'
        },
        onShow: null,
        onShown: null,
        onClose: null,
        onClosed: null,
        icon_type: 'class',
        template: '<div style="width: 300px;" data-notify="container" class="col-xs-11 col-sm-3 alert alert-{0}" role="alert">' +
            '<button type="button" aria-hidden="true" class="close" data-notify="dismiss">×</button>' +
            '<span data-notify="icon"></span> ' +
            '<span data-notify="title">{1}</span> ' +
            '<span data-notify="message">{2}</span>' +
            '<div class="progress" data-notify="progressbar">' +
                '<div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>' +
            '</div>' +
            '<a href="{3}" target="{4}" data-notify="url"></a>' +
        '</div>' 
    });
}

// 备份一下官方的信息通知
// function showNotify($msg, $type, $delay, $icon, $from, $align) {
//     $type  = $type || 'info';
//     $delay = $delay || 1000;
//     $from  = $from || 'top';
//     $align = $align || 'right';
//     $enter = $type == 'danger' ? 'animated shake' : 'animated fadeInUp';

//     jQuery.notify({
//         icon: $icon,
//         message: $msg
//     },
//     {
//         element: 'body',
//         type: $type,
//         allow_dismiss: true,
//         newest_on_top: true,
//         showProgressbar: false,
//         placement: {
//             from: $from,
//             align: $align
//         },
//         offset: 20,
//         spacing: 10,
//         z_index: 10800,
//         delay: $delay,
//         animate: {
//             enter: $enter,
//             exit: 'animated fadeOutDown'
//         }
//     });
// }
